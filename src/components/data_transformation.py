import sys
from dataclasses import dataclass

import numpy as np 
import pandas as pd
from sklearn.compose import ColumnTransformer
from sklearn.impute import SimpleImputer
from sklearn.pipeline import Pipeline
from sklearn.preprocessing import OrdinalEncoder,StandardScaler

from src.exception import CustomException
from src.logger import logging
import os
from src.utils import save_object
from datetime import timedelta


def time_date_handle(df):
    df['Order_Date_Year']=df['Order_Date'].apply(lambda x:int(x.split('-')[2]))
    df['Order_Date_Month']=df['Order_Date'].apply(lambda x:int(x.split('-')[1]))
    df['Order_Date_Day']=df['Order_Date'].apply(lambda x:int(x.split('-')[0]))
    df=df.drop('Order_Date',axis=1)
    
    df['Time_Orderd']=[str(timedelta(hours=int(time_str.split(':')[0]), minutes=int(time_str.split(':')[1]))-timedelta(hours=0, minutes=15)) if(':' not in str(i) and ':' in str(time_str)) else str(i) for i,time_str in zip(df['Time_Orderd'],df['Time_Order_picked'])]
    df['Time_Order_picked']=[str(timedelta(hours=int(time_str.split(':')[0]), minutes=int(time_str.split(':')[1]))+timedelta(hours=0, minutes=15)) if(':' not in str(i) and ':' in str(time_str)) else str(i) for i,time_str in zip(df['Time_Order_picked'],df['Time_Orderd'])]
    ind=df[df['Time_Orderd']=='nan'].index
    k=df['Time_Orderd'].mode()[0]
    df['Time_Orderd']=[k if i=='nan' else str(i) for i in df['Time_Orderd'] ]
    for i in ind:
        time_str=df['Time_Orderd'][i]
        df['Time_Order_picked'][i]=str(timedelta(hours=int(time_str.split(':')[0]), minutes=int(time_str.split(':')[1]))+timedelta(hours=0, minutes=15)) 
    df['Time_Order_picked']=[i.split(', ')[1] if '1 day' in i else str(i) for i in df['Time_Order_picked']]
    df['Time_Orderd']=[i.split(', ')[1] if '1 day' in i else str(i) for i in df['Time_Orderd']]
    df1=df
    df1['Time_Orderd_hrs']=df1['Time_Orderd'].apply(lambda x:int(x.split(':')[0]))
    df1['Time_Orderd_min']=df1['Time_Orderd'].apply(lambda x:int(x.split(':')[1]))
    df1['Time_Order_picked_hrs']=df1['Time_Order_picked'].apply(lambda x:int(x.split(':')[0]))
    df1['Time_Order_picked_min']=df1['Time_Order_picked'].apply(lambda x:int(x.split(':')[1]))
    df1.drop(['Time_Order_picked','Time_Orderd'],axis=1,inplace=True)
    return df1


@dataclass
class DataTransformationConfig:
    preprocessor_obj_file_path:str=os.path.join('artifacts','preprocessor.pkl')

class DataTransformation:
    def __init__(self):
        self.data_transformation_config=DataTransformationConfig()

    def get_data_transformation_object(self):
        
        try:
            logging.info('Data Transformation initiated')
            # Define which columns should be ordinal-encoded and which should be scaled
            categorical_cols = ['Delivery_person_ID', 'Weather_conditions', 'Road_traffic_density',
       'Type_of_order', 'Type_of_vehicle', 'Festival', 'City']
            numerical_cols = ['Delivery_person_Age', 'Delivery_person_Ratings', 'Restaurant_latitude',
                              'Restaurant_longitude', 'Delivery_location_latitude',
                              'Delivery_location_longitude', 'Vehicle_condition',
                              'multiple_deliveries', 'Order_Date_Year', 'Order_Date_Month',
                              'Order_Date_Day', 'Time_Orderd_hrs', 'Time_Orderd_min',
                              'Time_Order_picked_hrs', 'Time_Order_picked_min']
            
            # Define the custom ranking for each ordinal variable
            Delivery_person_ID_cat=['DEHRES17DEL01', 'KOCRES16DEL01', 'PUNERES13DEL03', 'LUDHRES15DEL02', 'KNPRES14DEL02', 'MUMRES15DEL03', 'MYSRES01DEL01', 'PUNERES20DEL01', 'HYDRES14DEL01', 'KOLRES15DEL03', 'PUNERES19DEL02', 'RANCHIRES06DEL02', 'COIMBRES13DEL01', 'CHENRES19DEL02', 'MUMRES02DEL01', 'CHENRES01DEL01', 'JAPRES16DEL03', 'SURRES15DEL03', 'BANGRES09DEL03', 'PUNERES04DEL01', 'COIMBRES02DEL03', 'SURRES16DEL02', 'GOARES15DEL02', 'GOARES07DEL01', 'RANCHIRES02DEL01', 'PUNERES02DEL01', 'PUNERES18DEL01', 'SURRES08DEL01', 'HYDRES17DEL02', 'BANGRES17DEL02', 'BANGRES17DEL01', 'CHENRES11DEL01', 'MUMRES17DEL02', 'SURRES17DEL03', 'MUMRES07DEL01', 'KOLRES16DEL02', 'MUMRES02DEL03', 'BANGRES05DEL03', 'SURRES09DEL01', 'RANCHIRES15DEL01', 'BANGRES19DEL01', 'AURGRES20DEL03', 'COIMBRES14DEL02', 'SURRES08DEL03', 'COIMBRES07DEL03', 'AGRRES12DEL03', 'VADRES02DEL02', 'JAPRES14DEL01', 'VADRES04DEL03', 'JAPRES18DEL02', 'MYSRES04DEL03', 'SURRES12DEL01', 'MUMRES04DEL01', 'ALHRES07DEL02', 'DEHRES19DEL02', 'VADRES16DEL02', 'VADRES09DEL01', 'CHENRES12DEL03', 'SURRES11DEL01', 'SURRES01DEL01', 'VADRES15DEL02', 'MYSRES14DEL02', 'BANGRES13DEL01', 'HYDRES13DEL03', 'BHPRES12DEL02', 'CHENRES11DEL03', 'BANGRES010DEL03', 'VADRES20DEL01', 'BANGRES11DEL01', 'DEHRES01DEL01', 'CHENRES02DEL01', 'JAPRES03DEL02', 'HYDRES04DEL03', 'PUNERES14DEL02', 'GOARES04DEL01', 'AURGRES08DEL02', 'BANGRES12DEL01', 'HYDRES05DEL01', 'RANCHIRES17DEL01', 'AGRRES010DEL01', 'INDORES12DEL02', 'JAPRES15DEL03', 'SURRES16DEL01', 'MYSRES16DEL02', 'MUMRES05DEL03', 'COIMBRES19DEL02', 'MYSRES07DEL01', 'PUNERES17DEL01', 'HYDRES19DEL03', 'MUMRES14DEL02', 'COIMBRES02DEL01', 'INDORES05DEL02', 'BANGRES03DEL03', 'MUMRES11DEL01', 'MYSRES12DEL02', 'SURRES09DEL02', 'COIMBRES12DEL02', 'KNPRES05DEL02', 'SURRES05DEL02', 'MUMRES15DEL01', 'BANGRES15DEL02', 'RANCHIRES11DEL03', 'MYSRES08DEL01', 'RANCHIRES07DEL02', 'RANCHIRES01DEL03', 'JAPRES17DEL03', 'VADRES06DEL01', 'INDORES14DEL01', 'COIMBRES17DEL01', 'KNPRES17DEL02', 'RANCHIRES04DEL01', 'KOLRES17DEL03', 'BANGRES19DEL02', 'MUMRES17DEL01', 'SURRES14DEL01', 'VADRES14DEL03', 'PUNERES09DEL02', 'INDORES19DEL02', 'BANGRES12DEL02', 'VADRES04DEL01', 'BANGRES11DEL03', 'COIMBRES13DEL03', 'PUNERES05DEL03', 'CHENRES19DEL01', 'HYDRES02DEL03', 'SURRES010DEL02', 'SURRES03DEL01', 'COIMBRES17DEL03', 'VADRES08DEL01', 'MUMRES08DEL01', 'VADRES18DEL01', 'BANGRES04DEL03', 'RANCHIRES12DEL02', 'MYSRES13DEL01', 'COIMBRES03DEL02', 'KOLRES04DEL03', 'COIMBRES11DEL01', 'VADRES13DEL03', 'RANCHIRES04DEL02', 'SURRES01DEL02', 'INDORES08DEL02', 'HYDRES18DEL03', 'CHENRES07DEL03', 'KOCRES010DEL01', 'VADRES11DEL02', 'CHENRES20DEL01', 'MUMRES13DEL01', 'RANCHIRES03DEL03', 'JAPRES08DEL02', 'ALHRES12DEL01', 'HYDRES19DEL02', 'PUNERES17DEL03', 'MYSRES010DEL01', 'JAPRES03DEL01', 'MUMRES06DEL03', 'MYSRES18DEL01', 'RANCHIRES18DEL01', 'INDORES06DEL02', 'CHENRES15DEL03', 'JAPRES07DEL02', 'SURRES18DEL03', 'SURRES19DEL01', 'HYDRES04DEL01', 'KNPRES16DEL03', 'MYSRES12DEL03', 'JAPRES09DEL01', 'CHENRES04DEL02', 'MYSRES09DEL01', 'PUNERES19DEL03', 'KOLRES18DEL03', 'BANGRES14DEL03', 'INDORES09DEL01', 'PUNERES09DEL03', 'RANCHIRES01DEL02', 'LUDHRES010DEL03', 'MYSRES13DEL02', 'COIMBRES11DEL02', 'VADRES13DEL02', 'BANGRES01DEL01', 'MYSRES15DEL01', 'CHENRES02DEL03', 'HYDRES12DEL01', 'BANGRES07DEL01', 'CHENRES09DEL01', 'BANGRES04DEL02', 'JAPRES13DEL02', 'ALHRES07DEL03', 'JAPRES06DEL03', 'KOCRES03DEL01', 'GOARES02DEL01', 'RANCHIRES03DEL02', 'HYDRES12DEL03', 'JAPRES13DEL03', 'JAPRES18DEL03', 'VADRES05DEL01', 'AURGRES02DEL03', 'RANCHIRES14DEL01', 'MUMRES20DEL03', 'HYDRES14DEL02', 'KNPRES02DEL02', 'AURGRES19DEL01', 'BANGRES08DEL02', 'KNPRES16DEL01', 'BANGRES010DEL02', 'INDORES03DEL02', 'COIMBRES16DEL02', 'HYDRES20DEL01', 'AGRRES08DEL03', 'COIMBRES15DEL02', 'ALHRES05DEL01', 'MUMRES01DEL01', 'AURGRES14DEL03', 'PUNERES16DEL01', 'CHENRES14DEL02', 'HYDRES06DEL03', 'COIMBRES16DEL01', 'INDORES13DEL03', 'INDORES12DEL03', 'MUMRES13DEL03', 'CHENRES06DEL02', 'BANGRES06DEL03', 'AGRRES11DEL02', 'KNPRES15DEL02', 'VADRES13DEL01', 'VADRES01DEL03', 'AGRRES03DEL01', 'KOCRES14DEL01', 'LUDHRES18DEL01', 'SURRES20DEL02', 'INDORES18DEL02', 'AURGRES04DEL02', 'BANGRES010DEL01', 'VADRES15DEL03', 'DEHRES010DEL01', 'CHENRES05DEL02', 'DEHRES12DEL02', 'VADRES01DEL01', 'SURRES13DEL02', 'LUDHRES05DEL03', 'PUNERES02DEL03', 'COIMBRES14DEL01', 'AGRRES010DEL02', 'SURRES14DEL03', 'JAPRES04DEL03', 'JAPRES01DEL03', 'HYDRES010DEL02', 'CHENRES15DEL02', 'MYSRES05DEL02', 'COIMBRES03DEL03', 'BANGRES01DEL02', 'KNPRES12DEL01', 'MUMRES010DEL01', 'COIMBRES20DEL03', 'RANCHIRES08DEL01', 'HYDRES16DEL01', 'MUMRES01DEL02', 'MYSRES08DEL03', 'AURGRES16DEL03', 'VADRES11DEL01', 'MYSRES09DEL02', 'PUNERES05DEL02', 'MYSRES02DEL03', 'MYSRES03DEL01', 'JAPRES16DEL02', 'SURRES15DEL02', 'MUMRES19DEL03', 'HYDRES05DEL03', 'AURGRES12DEL02', 'MUMRES07DEL03', 'VADRES12DEL03', 'JAPRES16DEL01', 'BANGRES09DEL02', 'PUNERES12DEL02', 'SURRES07DEL01', 'PUNERES19DEL01', 'INDORES15DEL03', 'INDORES17DEL03', 'MUMRES13DEL02', 'SURRES18DEL02', 'RANCHIRES010DEL02', 'BANGRES13DEL02', 'RANCHIRES01DEL01', 'PUNERES12DEL01', 'INDORES07DEL03', 'BANGRES20DEL01', 'MYSRES02DEL02', 'SURRES05DEL01', 'SURRES010DEL01', 'ALHRES09DEL01', 'HYDRES18DEL02', 'KOLRES03DEL02', 'RANCHIRES16DEL01', 'BANGRES16DEL03', 'PUNERES06DEL01', 'CHENRES15DEL01', 'JAPRES010DEL03', 'MYSRES15DEL02', 'COIMBRES19DEL01', 'COIMBRES09DEL03', 'SURRES19DEL02', 'BANGRES20DEL03', 'CHENRES16DEL03', 'RANCHIRES12DEL03', 'HYDRES11DEL03', 'DEHRES19DEL01', 'RANCHIRES18DEL03', 'VADRES07DEL01', 'JAPRES07DEL03', 'INDORES07DEL01', 'AURGRES03DEL01', 'CHENRES17DEL01', 'JAPRES20DEL03', 'KOCRES14DEL02', 'COIMBRES09DEL02', 'CHENRES08DEL03', 'INDORES010DEL03', 'SURRES04DEL03', 'BANGRES16DEL01', 'CHENRES14DEL01', 'CHENRES03DEL01', 'VADRES09DEL02', 'SURRES12DEL02', 'PUNERES11DEL03', 'RANCHIRES18DEL02', 'BANGRES15DEL01', 'GOARES17DEL01', 'JAPRES19DEL02', 'KOLRES18DEL01', 'SURRES07DEL02', 'INDORES12DEL01', 'LUDHRES16DEL01', 'RANCHIRES06DEL03', 'DEHRES13DEL02', 'MYSRES06DEL03', 'MUMRES16DEL01', 'BANGRES08DEL01', 'MYSRES20DEL01', 'AGRRES01DEL02', 'CHENRES010DEL01', 'COIMBRES20DEL02', 'COIMBRES14DEL03', 'CHENRES010DEL02', 'MUMRES07DEL02', 'ALHRES11DEL01', 'DEHRES07DEL02', 'INDORES08DEL03', 'HYDRES01DEL01', 'ALHRES11DEL02', 'BANGRES20DEL02', 'KOCRES20DEL01', 'HYDRES04DEL02', 'LUDHRES07DEL02', 'PUNERES010DEL01', 'VADRES010DEL02', 'BANGRES14DEL02', 'COIMBRES05DEL03', 'AURGRES07DEL02', 'KOCRES11DEL01', 'MYSRES17DEL01', 'HYDRES13DEL02', 'JAPRES14DEL03', 'AURGRES20DEL01', 'VADRES07DEL02', 'CHENRES08DEL02', 'AURGRES05DEL02', 'JAPRES17DEL02', 'RANCHIRES04DEL03', 'KOLRES14DEL02', 'VADRES14DEL01', 'LUDHRES06DEL02', 'HYDRES010DEL01', 'ALHRES08DEL03', 'PUNERES07DEL01', 'JAPRES20DEL01', 'CHENRES14DEL03', 'MUMRES14DEL03', 'DEHRES04DEL03', 'AURGRES03DEL03', 'VADRES16DEL01', 'INDORES02DEL03', 'ALHRES17DEL03', 'BANGRES08DEL03', 'AURGRES03DEL02', 'SURRES04DEL01', 'VADRES18DEL02', 'SURRES19DEL03', 'HYDRES07DEL01', 'INDORES15DEL02', 'COIMBRES12DEL03', 'SURRES03DEL02', 'CHENRES02DEL02', 'JAPRES13DEL01', 'AGRRES07DEL02', 'MYSRES11DEL02', 'PUNERES04DEL03', 'MYSRES07DEL03', 'AGRRES02DEL03', 'VADRES06DEL03', 'JAPRES05DEL01', 'HYDRES03DEL02', 'HYDRES15DEL02', 'KOLRES03DEL03', 'PUNERES11DEL02', 'INDORES01DEL02', 'COIMBRES17DEL02', 'JAPRES08DEL03', 'HYDRES16DEL03', 'VADRES12DEL02', 'PUNERES01DEL03', 'RANCHIRES14DEL02', 'PUNERES18DEL03', 'COIMBRES010DEL01', 'JAPRES02DEL01', 'MUMRES20DEL02', 'DEHRES08DEL03', 'JAPRES20DEL02', 'MYSRES19DEL03', 'BHPRES03DEL02', 'RANCHIRES11DEL02', 'COIMBRES15DEL01', 'BANGRES09DEL01', 'MYSRES01DEL02', 'MYSRES19DEL02', 'RANCHIRES16DEL02', 'MYSRES16DEL01', 'SURRES18DEL01', 'BANGRES02DEL02', 'INDORES04DEL02', 'PUNERES15DEL01', 'MYSRES14DEL03', 'VADRES14DEL02', 'HYDRES13DEL01', 'BANGRES03DEL02', 'ALHRES11DEL03', 'PUNERES14DEL01', 'INDORES11DEL01', 'BHPRES15DEL03', 'ALHRES19DEL03', 'COIMBRES19DEL03', 'JAPRES03DEL03', 'BANGRES04DEL01', 'ALHRES09DEL02', 'CHENRES06DEL03', 'MUMRES16DEL02', 'CHENRES09DEL02', 'COIMBRES02DEL02', 'MYSRES05DEL03', 'BANGRES06DEL02', 'INDORES16DEL02', 'AURGRES11DEL01', 'RANCHIRES20DEL02', 'AURGRES09DEL03', 'KOLRES11DEL02', 'RANCHIRES010DEL01', 'JAPRES06DEL01', 'LUDHRES18DEL03', 'GOARES19DEL01', 'KOLRES20DEL02', 'INDORES08DEL01', 'BHPRES03DEL03', 'VADRES19DEL03', 'JAPRES09DEL03', 'INDORES06DEL03', 'MUMRES09DEL03', 'SURRES010DEL03', 'DEHRES08DEL01', 'SURRES15DEL01', 'CHENRES05DEL03', 'VADRES11DEL03', 'VADRES08DEL03', 'INDORES20DEL02', 'VADRES15DEL01', 'RANCHIRES15DEL03', 'LUDHRES04DEL03', 'RANCHIRES17DEL02', 'JAPRES04DEL02', 'PUNERES06DEL02', 'BHPRES11DEL03', 'PUNERES09DEL01', 'JAPRES06DEL02', 'CHENRES18DEL03', 'BANGRES17DEL03', 'GOARES19DEL02', 'MUMRES15DEL02', 'BHPRES04DEL01', 'KNPRES19DEL03', 'KOLRES04DEL01', 'RANCHIRES20DEL01', 'KOLRES12DEL01', 'COIMBRES06DEL03', 'LUDHRES08DEL01', 'HYDRES010DEL03', 'BHPRES14DEL03', 'MYSRES20DEL02', 'CHENRES18DEL01', 'BANGRES14DEL01', 'COIMBRES04DEL02', 'CHENRES09DEL03', 'AGRRES02DEL02', 'RANCHIRES09DEL03', 'ALHRES010DEL02', 'HYDRES06DEL01', 'HYDRES20DEL02', 'COIMBRES07DEL02', 'CHENRES18DEL02', 'AURGRES01DEL02', 'MYSRES02DEL01', 'DEHRES02DEL01', 'JAPRES15DEL01', 'VADRES12DEL01', 'AURGRES13DEL02', 'HYDRES11DEL02', 'VADRES20DEL02', 'CHENRES13DEL02', 'SURRES11DEL02', 'CHENRES17DEL02', 'BANGRES11DEL02', 'LUDHRES13DEL03', 'VADRES010DEL01', 'GOARES07DEL02', 'DEHRES14DEL02', 'INDORES14DEL02', 'JAPRES010DEL01', 'AGRRES04DEL02', 'VADRES09DEL03', 'CHENRES010DEL03', 'HYDRES02DEL02', 'AGRRES09DEL03', 'VADRES01DEL02', 'RANCHIRES06DEL01', 'DEHRES12DEL03', 'AURGRES01DEL01', 'ALHRES18DEL02', 'GOARES20DEL01', 'MUMRES11DEL02', 'SURRES06DEL01', 'PUNERES07DEL02', 'COIMBRES010DEL03', 'VADRES04DEL02', 'COIMBRES06DEL01', 'JAPRES05DEL03', 'GOARES17DEL03', 'PUNERES06DEL03', 'AGRRES01DEL01', 'VADRES19DEL01', 'BHPRES07DEL02', 'RANCHIRES05DEL01', 'KOLRES17DEL02', 'INDORES18DEL01', 'BHPRES08DEL01', 'RANCHIRES16DEL03', 'RANCHIRES09DEL01', 'PUNERES02DEL02', 'HYDRES11DEL01', 'CHENRES12DEL02', 'HYDRES09DEL03', 'PUNERES08DEL03', 'LUDHRES08DEL03', 'BHPRES19DEL02', 'CHENRES04DEL03', 'JAPRES12DEL03', 'INDORES13DEL02', 'HYDRES16DEL02', 'COIMBRES01DEL01', 'KOCRES09DEL03', 'ALHRES20DEL02', 'MYSRES08DEL02', 'JAPRES05DEL02', 'SURRES02DEL01', 'PUNERES15DEL02', 'INDORES05DEL01', 'HYDRES12DEL02', 'JAPRES11DEL03', 'MUMRES06DEL01', 'KOLRES14DEL03', 'BHPRES05DEL01', 'VADRES20DEL03', 'SURRES06DEL02', 'AGRRES16DEL01', 'MYSRES04DEL01', 'MUMRES20DEL01', 'BANGRES07DEL02', 'BANGRES18DEL03', 'RANCHIRES13DEL02', 'COIMBRES06DEL02', 'LUDHRES12DEL02', 'HYDRES03DEL03', 'LUDHRES20DEL03', 'HYDRES07DEL02', 'MYSRES11DEL03', 'ALHRES12DEL02', 'AURGRES19DEL02', 'DEHRES17DEL03', 'CHENRES16DEL02', 'INDORES09DEL02', 'HYDRES08DEL01', 'MYSRES010DEL02', 'GOARES11DEL03', 'BANGRES13DEL03', 'ALHRES12DEL03', 'MYSRES16DEL03', 'INDORES09DEL03', 'MYSRES20DEL03', 'VADRES05DEL02', 'MUMRES16DEL03', 'CHENRES04DEL01', 'SURRES16DEL03', 'KNPRES11DEL02', 'PUNERES15DEL03', 'KOCRES05DEL03', 'INDORES13DEL01', 'HYDRES02DEL01', 'RANCHIRES17DEL03', 'SURRES08DEL02', 'LUDHRES01DEL02', 'AURGRES18DEL01', 'KNPRES08DEL02', 'BHPRES12DEL01', 'VADRES19DEL02', 'AURGRES14DEL01', 'HYDRES15DEL01', 'COIMBRES010DEL02', 'PUNERES20DEL02', 'SURRES13DEL03', 'KOLRES12DEL03', 'JAPRES15DEL02', 'PUNERES05DEL01', 'BANGRES18DEL01', 'RANCHIRES08DEL02', 'BHPRES07DEL01', 'RANCHIRES13DEL03', 'KOLRES07DEL02', 'AGRRES08DEL02', 'INDORES07DEL02', 'MUMRES05DEL02', 'KOLRES15DEL01', 'PUNERES16DEL02', 'SURRES20DEL01', 'BHPRES06DEL02', 'VADRES02DEL03', 'PUNERES08DEL02', 'JAPRES18DEL01', 'LUDHRES04DEL01', 'COIMBRES12DEL01', 'MYSRES17DEL03', 'INDORES17DEL02', 'JAPRES12DEL01', 'BHPRES18DEL03', 'JAPRES04DEL01', 'CHENRES03DEL03', 'AGRRES11DEL03', 'PUNERES010DEL03', 'INDORES11DEL03', 'BANGRES06DEL01', 'RANCHIRES02DEL03', 'SURRES12DEL03', 'BHPRES04DEL03', 'MUMRES18DEL01', 'VADRES03DEL02', 'MUMRES02DEL02', 'CHENRES07DEL02', 'CHENRES08DEL01', 'KNPRES010DEL01', 'MYSRES18DEL03', 'KNPRES03DEL01', 'KNPRES01DEL03', 'PUNERES010DEL02', 'MUMRES08DEL03', 'KOCRES15DEL03', 'CHENRES19DEL03', 'GOARES010DEL03', 'AGRRES09DEL02', 'INDORES20DEL01', 'HYDRES05DEL02', 'MUMRES12DEL01', 'BANGRES02DEL03', 'AGRRES15DEL03', 'LUDHRES01DEL03', 'LUDHRES02DEL03', 'VADRES17DEL02', 'MUMRES010DEL03', 'PUNERES07DEL03', 'LUDHRES07DEL03', 'PUNERES12DEL03', 'AGRRES15DEL01', 'AURGRES06DEL01', 'MYSRES05DEL01', 'COIMBRES13DEL02', 'COIMBRES04DEL01', 'KNPRES15DEL03', 'INDORES010DEL01', 'RANCHIRES02DEL02', 'MUMRES09DEL02', 'VADRES02DEL01', 'COIMBRES01DEL03', 'MYSRES06DEL01', 'COIMBRES03DEL01', 'MUMRES18DEL02', 'BANGRES02DEL01', 'RANCHIRES09DEL02', 'GOARES05DEL02', 'PUNERES13DEL02', 'BANGRES01DEL03', 'CHENRES11DEL02', 'VADRES16DEL03', 'MUMRES08DEL02', 'COIMBRES18DEL02', 'MUMRES03DEL01', 'DEHRES13DEL01', 'DEHRES06DEL03', 'INDORES11DEL02', 'VADRES08DEL02', 'INDORES20DEL03', 'SURRES20DEL03', 'BANGRES12DEL03', 'CHENRES01DEL02', 'KNPRES09DEL03', 'GOARES19DEL03', 'INDORES010DEL02', 'LUDHRES15DEL03', 'MYSRES18DEL02', 'CHENRES07DEL01', 'PUNERES03DEL01', 'KOLRES13DEL03', 'HYDRES09DEL01', 'DEHRES14DEL03', 'MYSRES19DEL01', 'BHPRES08DEL02', 'INDORES03DEL03', 'PUNERES18DEL02', 'VADRES03DEL03', 'AURGRES02DEL02', 'INDORES19DEL01', 'DEHRES09DEL02', 'SURRES17DEL02', 'SURRES14DEL02', 'KOCRES06DEL01', 'GOARES20DEL02', 'GOARES16DEL03', 'HYDRES18DEL01', 'KNPRES01DEL02', 'BANGRES19DEL03', 'MUMRES19DEL01', 'CHENRES12DEL01', 'KOLRES19DEL01', 'COIMBRES18DEL03', 'INDORES04DEL01', 'MUMRES03DEL02', 'ALHRES16DEL02', 'KNPRES14DEL01', 'RANCHIRES03DEL01', 'CHENRES20DEL03', 'VADRES010DEL03', 'PUNERES11DEL01', 'KNPRES04DEL02', 'JAPRES01DEL01', 'AURGRES16DEL01', 'INDORES02DEL01', 'MUMRES19DEL02', 'BHPRES17DEL01', 'JAPRES02DEL02', 'AGRRES03DEL02', 'LUDHRES20DEL01', 'COIMBRES11DEL03', 'BHPRES20DEL02', 'KOLRES06DEL03', 'INDORES06DEL01', 'KNPRES11DEL03', 'GOARES04DEL02', 'MUMRES18DEL03', 'LUDHRES09DEL02', 'HYDRES08DEL03', 'KNPRES01DEL01', 'BHPRES02DEL02', 'HYDRES15DEL03', 'PUNERES17DEL02', 'AGRRES04DEL01', 'MYSRES09DEL03', 'SURRES06DEL03', 'SURRES17DEL01', 'JAPRES11DEL01', 'RANCHIRES07DEL03', 'GOARES03DEL01', 'INDORES02DEL02', 'ALHRES04DEL03', 'BANGRES07DEL03', 'LUDHRES20DEL02', 'PUNERES08DEL01', 'ALHRES14DEL01', 'DEHRES02DEL03', 'LUDHRES11DEL01', 'MUMRES04DEL03', 'RANCHIRES05DEL03', 'PUNERES16DEL03', 'KOLRES01DEL02', 'MYSRES06DEL02', 'SURRES11DEL03', 'KNPRES19DEL01', 'INDORES03DEL01', 'PUNERES14DEL03', 'LUDHRES08DEL02', 'BHPRES010DEL03', 'LUDHRES05DEL02', 'RANCHIRES19DEL01', 'DEHRES17DEL02', 'INDORES15DEL01', 'HYDRES06DEL02', 'MYSRES11DEL01', 'COIMBRES05DEL01', 'HYDRES03DEL01', 'RANCHIRES15DEL02', 'COIMBRES18DEL01', 'RANCHIRES010DEL03', 'AGRRES17DEL03', 'GOARES12DEL02', 'JAPRES07DEL01', 'KOLRES06DEL01', 'BHPRES09DEL01', 'AURGRES12DEL03', 'DEHRES11DEL03', 'CHENRES13DEL03', 'COIMBRES07DEL01', 'DEHRES07DEL03', 'KOLRES05DEL03', 'COIMBRES05DEL02', 'JAPRES11DEL02', 'ALHRES16DEL03', 'PUNERES01DEL02', 'RANCHIRES12DEL01', 'RANCHIRES19DEL03', 'DEHRES18DEL01', 'AGRRES13DEL01', 'GOARES010DEL01', 'MYSRES15DEL03', 'INDORES16DEL03', 'SURRES02DEL02', 'BANGRES05DEL01', 'GOARES14DEL03', 'AGRRES14DEL02', 'LUDHRES03DEL03', 'COIMBRES09DEL01', 'DEHRES11DEL01', 'MYSRES07DEL02', 'HYDRES17DEL03', 'AGRRES20DEL03', 'MUMRES010DEL02', 'DEHRES20DEL01', 'GOARES010DEL02', 'MYSRES14DEL01', 'SURRES04DEL02', 'CHENRES01DEL03', 'MUMRES01DEL03', 'RANCHIRES11DEL01', 'ALHRES06DEL01', 'BHPRES13DEL02', 'RANCHIRES20DEL03', 'JAPRES19DEL03', 'BANGRES18DEL02', 'BANGRES15DEL03', 'BHPRES16DEL02', 'JAPRES010DEL02', 'JAPRES09DEL02', 'AURGRES06DEL02', 'MYSRES13DEL03', 'MYSRES010DEL03', 'LUDHRES010DEL02', 'DEHRES04DEL01', 'AGRRES18DEL02', 'KNPRES15DEL01', 'MUMRES17DEL03', 'BANGRES05DEL02', 'JAPRES01DEL02', 'PUNERES03DEL02', 'KOLRES04DEL02', 'KNPRES08DEL01', 'KOCRES13DEL02', 'VADRES17DEL01', 'JAPRES14DEL02', 'INDORES01DEL03', 'HYDRES19DEL01', 'AGRRES05DEL02', 'KOCRES19DEL02', 'BHPRES18DEL01', 'MYSRES17DEL02', 'VADRES07DEL03', 'KNPRES13DEL03', 'JAPRES08DEL01', 'INDORES05DEL03', 'RANCHIRES13DEL01', 'KOCRES16DEL02', 'KOLRES16DEL01', 'GOARES09DEL01', 'ALHRES20DEL01', 'HYDRES01DEL02', 'SURRES02DEL03', 'INDORES18DEL03', 'CHENRES17DEL03', 'MUMRES06DEL02', 'HYDRES17DEL01', 'RANCHIRES07DEL01', 'MUMRES11DEL03', 'CHENRES20DEL02', 'KOCRES12DEL03', 'BANGRES16DEL02', 'HYDRES14DEL03', 'PUNERES01DEL01', 'KNPRES03DEL02', 'AGRRES19DEL01', 'ALHRES01DEL02', 'DEHRES16DEL03', 'SURRES09DEL03', 'GOARES14DEL01', 'KOLRES08DEL02', 'HYDRES20DEL03', 'AGRRES17DEL01', 'CHENRES16DEL01', 'GOARES05DEL03', 'KNPRES06DEL03', 'KOCRES17DEL01', 'VADRES05DEL03', 'KOLRES08DEL03', 'INDORES16DEL01', 'JAPRES19DEL01', 'DEHRES05DEL03', 'KOCRES15DEL02', 'JAPRES02DEL03', 'AGRRES16DEL03', 'ALHRES18DEL01', 'VADRES03DEL01', 'CHENRES05DEL01', 'ALHRES07DEL01', 'COIMBRES15DEL03', 'INDORES17DEL01', 'GOARES18DEL03', 'AGRRES14DEL03', 'DEHRES16DEL02', 'AURGRES02DEL01', 'COIMBRES08DEL03', 'LUDHRES17DEL01', 'INDORES14DEL03', 'COIMBRES08DEL02', 'GOARES01DEL01', 'JAPRES12DEL02', 'COIMBRES16DEL03', 'BHPRES20DEL01', 'AURGRES010DEL01', 'KOCRES09DEL02', 'MUMRES05DEL01', 'VADRES17DEL03', 'KNPRES16DEL02', 'KNPRES04DEL03', 'KOCRES03DEL02', 'PUNERES13DEL01', 'HYDRES08DEL02', 'GOARES08DEL03', 'BHPRES13DEL01', 'AURGRES12DEL01', 'CHENRES03DEL02', 'GOARES06DEL02', 'KOLRES16DEL03', 'AURGRES04DEL01', 'KNPRES12DEL02', 'MYSRES04DEL02', 'RANCHIRES14DEL03', 'PUNERES03DEL03', 'MYSRES01DEL03', 'MUMRES04DEL02', 'KOLRES14DEL01', 'COIMBRES04DEL03', 'DEHRES03DEL03', 'KOLRES010DEL02', 'SURRES03DEL03', 'SURRES05DEL03', 'GOARES09DEL02', 'KOLRES12DEL02', 'CHENRES13DEL01', 'LUDHRES12DEL03', 'MUMRES09DEL01', 'MUMRES03DEL03', 'DEHRES010DEL03', 'KNPRES010DEL03', 'KOLRES19DEL03', 'GOARES12DEL01', 'DEHRES11DEL02', 'SURRES07DEL03', 'HYDRES01DEL03', 'LUDHRES19DEL01', 'AURGRES18DEL03', 'KOCRES08DEL02', 'ALHRES03DEL03', 'AURGRES05DEL03', 'PUNERES04DEL02', 'GOARES02DEL03', 'KNPRES07DEL03', 'BHPRES02DEL01', 'ALHRES01DEL01', 'KOCRES13DEL03', 'SURRES13DEL01', 'MYSRES12DEL01', 'KNPRES13DEL02', 'KOLRES18DEL02', 'KOCRES15DEL01', 'BHPRES01DEL03', 'LUDHRES02DEL01', 'GOARES16DEL01', 'GOARES15DEL01', 'LUDHRES14DEL03', 'GOARES13DEL02', 'AGRRES12DEL02', 'DEHRES13DEL03', 'AURGRES15DEL02', 'DEHRES09DEL03', 'VADRES06DEL02', 'DEHRES15DEL01', 'LUDHRES13DEL01', 'LUDHRES03DEL01', 'COIMBRES01DEL02', 'ALHRES14DEL02', 'RANCHIRES08DEL03', 'AURGRES18DEL02', 'KOCRES010DEL03', 'KNPRES19DEL02', 'AURGRES19DEL03', 'KOCRES010DEL02', 'MUMRES12DEL03', 'AURGRES08DEL01', 'AURGRES13DEL03', 'KOLRES19DEL02', 'DEHRES16DEL01', 'CHENRES06DEL01', 'KNPRES11DEL01', 'BHPRES03DEL01', 'INDORES04DEL03', 'KOLRES010DEL03', 'AGRRES07DEL01', 'INDORES19DEL03', 'BHPRES12DEL03', 'GOARES13DEL03', 'KOCRES14DEL03', 'HYDRES09DEL02', 'KOCRES18DEL01', 'KNPRES02DEL03', 'KOLRES09DEL02', 'GOARES14DEL02', 'HYDRES07DEL03', 'KOCRES12DEL01', 'ALHRES13DEL03', 'DEHRES06DEL02', 'KOLRES15DEL02', 'AGRRES17DEL02', 'VADRES18DEL03', 'LUDHRES14DEL01', 'BHPRES06DEL01', 'AURGRES07DEL03', 'ALHRES18DEL03', 'GOARES04DEL03', 'RANCHIRES05DEL02', 'GOARES09DEL03', 'COIMBRES08DEL01', 'AGRRES01DEL03', 'KOLRES20DEL03', 'DEHRES05DEL01', 'ALHRES03DEL01', 'KOLRES03DEL01', 'LUDHRES11DEL02', 'KNPRES13DEL01', 'AURGRES08DEL03', 'AGRRES06DEL03', 'KOCRES08DEL01', 'ALHRES14DEL03', 'DEHRES18DEL02', 'AGRRES15DEL02', 'LUDHRES11DEL03', 'BHPRES15DEL02', 'GOARES11DEL02', 'PUNERES20DEL03', 'LUDHRES09DEL03', 'DEHRES04DEL02', 'GOARES07DEL03', 'BHPRES010DEL01', 'INDORES01DEL01', 'KOCRES01DEL03', 'KOCRES05DEL02', 'KOCRES02DEL01', 'RANCHIRES19DEL02', 'MUMRES12DEL02', 'KOCRES03DEL03', 'KOCRES12DEL02', 'GOARES16DEL02', 'ALHRES08DEL02', 'AGRRES07DEL03', 'KNPRES17DEL03', 'AURGRES09DEL02', 'KNPRES18DEL02', 'LUDHRES19DEL02', 'ALHRES04DEL01', 'GOARES03DEL02', 'ALHRES01DEL03', 'LUDHRES16DEL02', 'KOCRES07DEL02', 'MYSRES03DEL03', 'AGRRES03DEL03', 'AURGRES20DEL02', 'KOLRES17DEL01', 'LUDHRES17DEL03', 'SURRES01DEL03', 'ALHRES17DEL01', 'KOLRES08DEL01', 'KOCRES11DEL03', 'LUDHRES02DEL02', 'BHPRES07DEL03', 'BHPRES01DEL01', 'COIMBRES20DEL01', 'DEHRES19DEL03', 'BHPRES13DEL03', 'BHPRES01DEL02', 'AURGRES17DEL03', 'AURGRES14DEL02', 'KOLRES09DEL03', 'KNPRES07DEL02', 'AGRRES04DEL03', 'AGRRES13DEL02', 'AGRRES09DEL01', 'GOARES11DEL01', 'LUDHRES06DEL03', 'AURGRES15DEL03', 'BHPRES16DEL01', 'KOLRES11DEL03', 'DEHRES15DEL03', 'KOCRES07DEL01', 'GOARES01DEL02', 'ALHRES08DEL01', 'DEHRES07DEL01', 'LUDHRES17DEL02', 'KNPRES010DEL02', 'KOLRES11DEL01', 'DEHRES09DEL01', 'KOLRES13DEL02', 'KOCRES16DEL03', 'BHPRES04DEL02', 'KNPRES03DEL03', 'KOLRES02DEL03', 'ALHRES15DEL03', 'BANGRES03DEL01', 'AGRRES13DEL03', 'KOCRES02DEL02', 'KOLRES02DEL01', 'ALHRES05DEL03', 'AGRRES06DEL01', 'ALHRES02DEL02', 'DEHRES15DEL02', 'KOCRES04DEL02', 'KOCRES18DEL03', 'BHPRES16DEL03', 'KNPRES05DEL03', 'KOLRES06DEL02', 'JAPRES17DEL01', 'AGRRES05DEL01', 'KNPRES12DEL03', 'DEHRES20DEL02', 'ALHRES09DEL03', 'AURGRES17DEL02', 'AGRRES19DEL02', 'LUDHRES15DEL01', 'GOARES15DEL03', 'KNPRES07DEL01', 'LUDHRES16DEL03', 'KNPRES14DEL03', 'KNPRES09DEL02', 'BHPRES15DEL01', 'KNPRES06DEL01', 'DEHRES06DEL01', 'ALHRES06DEL02', 'ALHRES010DEL01', 'KOLRES05DEL01', 'AGRRES010DEL03', 'GOARES02DEL02', 'KOLRES01DEL03', 'KNPRES09DEL01', 'DEHRES14DEL01', 'ALHRES04DEL02', 'ALHRES010DEL03', 'AGRRES14DEL01', 'LUDHRES13DEL02', 'LUDHRES05DEL01', 'GOARES08DEL02', 'AURGRES15DEL01', 'GOARES08DEL01', 'BHPRES17DEL03', 'BHPRES010DEL02', 'AURGRES07DEL01', 'GOARES13DEL01', 'ALHRES15DEL02', 'DEHRES01DEL02', 'GOARES18DEL01', 'KOCRES06DEL03', 'KOLRES07DEL03', 'KOCRES19DEL03', 'DEHRES03DEL02', 'KNPRES06DEL02', 'LUDHRES18DEL02', 'BHPRES14DEL01', 'MYSRES03DEL02', 'BHPRES02DEL03', 'KNPRES08DEL03', 'AURGRES17DEL01', 'KOLRES09DEL01', 'GOARES17DEL02', 'KOCRES20DEL02', 'ALHRES16DEL01', 'ALHRES13DEL02', 'KOLRES010DEL01', 'LUDHRES09DEL01', 'DEHRES08DEL02', 'ALHRES19DEL02', 'DEHRES03DEL01', 'DEHRES010DEL02', 'KOCRES01DEL01', 'AURGRES010DEL03', 'ALHRES17DEL02', 'KOLRES13DEL01', 'AGRRES18DEL03', 'MUMRES14DEL01', 'ALHRES02DEL03', 'DEHRES20DEL03', 'KOLRES01DEL01', 'ALHRES03DEL02', 'AURGRES05DEL01', 'KOCRES20DEL03', 'BHPRES19DEL03', 'AGRRES20DEL02', 'ALHRES20DEL03', 'LUDHRES04DEL02', 'DEHRES02DEL02', 'LUDHRES19DEL03', 'LUDHRES14DEL02', 'BHPRES05DEL02', 'KOCRES09DEL01', 'KOCRES11DEL02', 'DEHRES12DEL01', 'AGRRES06DEL02', 'AURGRES16DEL02', 'AGRRES20DEL01', 'BHPRES09DEL03', 'AURGRES01DEL03', 'GOARES06DEL03', 'AGRRES05DEL03', 'GOARES06DEL01', 'LUDHRES07DEL01', 'KOCRES07DEL03', 'KOCRES13DEL01', 'AURGRES11DEL02', 'AGRRES02DEL01', 'KOCRES05DEL01', 'AURGRES11DEL03', 'KOCRES17DEL03', 'ALHRES02DEL01', 'KNPRES04DEL01', 'KNPRES17DEL01', 'BHPRES05DEL03', 'KOCRES01DEL02', 'AGRRES19DEL03', 'GOARES20DEL03', 'KNPRES20DEL03', 'AGRRES18DEL01', 'BHPRES18DEL02', 'GOARES05DEL01', 'AGRRES12DEL01', 'BHPRES14DEL02', 'BHPRES19DEL01', 'KOLRES02DEL02', 'KOCRES04DEL03', 'KNPRES20DEL01', 'ALHRES15DEL01', 'AURGRES06DEL03', 'GOARES18DEL02', 'LUDHRES12DEL01', 'KOLRES05DEL02', 'KOCRES19DEL01', 'AURGRES04DEL03', 'BHPRES11DEL02', 'ALHRES05DEL02', 'BHPRES11DEL01', 'BHPRES09DEL02', 'ALHRES13DEL01', 'GOARES12DEL03', 'KOCRES02DEL03', 'BHPRES17DEL02', 'ALHRES06DEL03', 'LUDHRES010DEL01', 'LUDHRES06DEL01', 'DEHRES01DEL03', 'KOLRES20DEL01', 'BHPRES20DEL03', 'KNPRES02DEL01', 'KNPRES20DEL02', 'ALHRES19DEL01', 'AURGRES010DEL02', 'KOCRES17DEL02', 'AGRRES08DEL01', 'DEHRES18DEL03', 'KOCRES18DEL02', 'DEHRES05DEL02', 'AGRRES11DEL01', 'KOLRES07DEL01', 'KNPRES18DEL03', 'LUDHRES01DEL01', 'AGRRES16DEL02', 'AURGRES09DEL01', 'KOCRES06DEL02', 'KNPRES18DEL01', 'BHPRES08DEL03', 'AURGRES13DEL01', 'LUDHRES03DEL02', 'KNPRES05DEL01', 'GOARES01DEL03', 'KOCRES08DEL03', 'KOCRES04DEL01', 'BHPRES06DEL03', 'GOARES03DEL03']
            Weather_conditions_cat=['Fog','Stormy','Sandstorms','Windy','Cloudy','Sunny']
            Road_traffic_density_cat=['Jam','High', 'Medium', 'Low']
            Type_of_order_cat=['Snack', 'Meal', 'Drinks', 'Buffet']
            Type_of_vehicle_cat=['motorcycle', 'scooter', 'electric_scooter', 'bicycle']
            Festival_cat=['No', 'Yes']
            City_cat=['Metropolitian', 'Urban', 'Semi-Urban']
            
            logging.info('Pipeline Initiated')
           ## Numerical Pipeline
            ## Numerical pipeline
            num_pipeline=Pipeline(
                steps=[
                ('imputer',SimpleImputer(strategy='median')),
                ('scaler',StandardScaler())

                ]

            )

            ## Categorical pipeline
            cat_pipeline=Pipeline(
                steps=[
                ('imputer',SimpleImputer(strategy='most_frequent')),
                ('ordinalencoder',OrdinalEncoder(categories=[Delivery_person_ID_cat,Weather_conditions_cat,Road_traffic_density_cat,Type_of_order_cat,Type_of_vehicle_cat,Festival_cat,City_cat])),
                ('scaler',StandardScaler())
                ]

            )

            preprocessor=ColumnTransformer([
            ('num_pipeline',num_pipeline,numerical_cols),
            ('cat_pipeline',cat_pipeline,categorical_cols)
            ])
            
            logging.info('Pipeline Completed')
            return preprocessor

            
            
        except Exception as e:
            logging.info("Error in Data Transformation")
            raise CustomException(e,sys)
    
    def initiate_data_transformation(self,train_path,test_path):
        try:
            # Reading train and test data
            train_df = pd.read_csv(train_path)
            test_df = pd.read_csv(test_path)

            logging.info('Read train and test data completed')
            logging.info(f'Train Dataframe Head : \n{train_df.head().to_string()}')
            logging.info(f'Test Dataframe Head  : \n{test_df.head().to_string()}')

            logging.info('Obtaining preprocessing object')

            preprocessing_obj = self.get_data_transformation_object()
            target_column_name = 'Time_taken (min)'
            drop_columns = [target_column_name,'ID']

            input_feature_train_df = train_df.drop(columns=drop_columns,axis=1)
            target_feature_train_df=train_df[target_column_name]

            input_feature_test_df=test_df.drop(columns=drop_columns,axis=1)
            target_feature_test_df=test_df[target_column_name]

            ## Trnasformating using preprocessor obj
            input_feature_train_arr=preprocessing_obj.fit_transform(input_feature_train_df)
            input_feature_test_arr=preprocessing_obj.transform(input_feature_test_df)
            
            logging.info("Applying preprocessing object on training and testing datasets.")

            train_arr = np.c_[input_feature_train_arr, np.array(target_feature_train_df)]
            test_arr = np.c_[input_feature_test_arr, np.array(target_feature_test_df)]

            save_object(

                file_path=self.data_transformation_config.preprocessor_obj_file_path,
                obj=preprocessing_obj

            )
            logging.info('Preprocessor pickle file saved')

            return (
                train_arr,
                test_arr,
                self.data_transformation_config.preprocessor_obj_file_path,
            )


            
        except Exception as e:
            logging.info("Exception occured in the initiate_datatransformation")
            raise CustomException(e,sys)